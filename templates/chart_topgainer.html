<!DOCTYPE html>
<html>
<head>
    <title>Contributors Data</title>
</head>
<body>
    <form id="contributorsForm">
        <label for="filter">Filter:</label>
        <select name="filter" id="filter">
            <option value="nifty50">Nifty50</option>
            <option value="niftynext50">NiftyNext50</option>
            <option value="banknifty">BankNifty</option>
            <option value="finnifty">FinNifty</option>
        </select>
        <br><br>
        <label for="date">Date:</label>
        <select name="date" id="date">
            <!-- Populate with dates from backend -->
        </select>
        <br><br>
        <button type="submit">Submit</button>
    </form>

    <div id="resultContainer">
        <!-- Display result from backend here -->
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Fetch dates on page load
            fetchDates();

            // Fetch dates on filter change
            $('#filter').on('change', function () {
                fetchDates();
            });

            // Submit form data
            $('#contributorsForm').on('submit', function (event) {
                event.preventDefault();
                var filter = $('#filter').val();
                var date = $('#date').val();

                $.ajax({
                    url: 'contrib_test',
                    method: 'GET',
                    data: {
                        'filter': filter,
                        'date': date
                    },
                    success: function (response) {
                        // Handle success response and update the result container
                        $('#resultContainer').text(JSON.stringify(response));
                    },
                    error: function (error) {
                        // Handle error response and update the result container
                        $('#resultContainer').text(JSON.stringify(error.responseJSON));
                    }
                });
            });

            // Function to fetch dates from backend
            function fetchDates() {
                var filter = $('#filter').val();

                $.ajax({
                    url: 'contrib_test',
                    method: 'GET',
                    data: {
                        'filter': filter
                    },
                    success: function (response) {
                        // Update the date dropdown with fetched dates
                        var dates = response.all_dates;
                        var dateDropdown = $('#date');
                        dateDropdown.empty();

                        for (var i = 0; i < dates.length; i++) {
                            dateDropdown.append($('<option>').val(dates[i]).text(dates[i]));
                        }
                    },
                    error: function (error) {
                        // Handle error response
                        console.log(error);
                    }
                });
            }
        });
    </script>
</body>
</html>
