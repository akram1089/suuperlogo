<!DOCTYPE html>
<html>
<head>
    <title>Dropdown Example</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>
<body>
    <h1>Dropdown Example</h1>
    
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <label for="expiry-date">Select Expiry Date:</label>
                <select id="expiry-date" class="form-control">
                    <!-- Options for Symbol_expiry_date_op will be added dynamically -->
                </select>
            </div>
            <div class="col-md-6">
                <label for="symbol">Select Symbol:</label>
               
                <select id="symbol" class="form-control">
                    <!-- Options for symbol_names will be added dynamically -->
                </select>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script>
        // Fetch data using AJAX
        function fetchData() {
            var selectedExpiryDate_op = $("#expiry-date").val();
            var selectedSymbol_op = $("#symbol").val();
            
            $.ajax({
                url: "/new_options_data",
                method: "GET",
                dataType: "json",
                data: {
                    date: selectedExpiryDate_op,
                    symbol: selectedSymbol_op
                },
                success: function(data) {
                    // Populate expiry date dropdown
                    var expiryDateDropdown = $("#expiry-date");
                    expiryDateDropdown.empty();
                    $.each(data.Symbol_expiry_date_op, function(index, date) {
                        expiryDateDropdown.append($("<option></option>").val(date).text(date));
                    });
                    
                    // Populate symbol dropdown
                    var symbolDropdown = $("#symbol");
                    symbolDropdown.empty();
                    $.each(data.symbol_names, function(index, symbol) {
                        symbolDropdown.append($("<option></option>").val(symbol).text(symbol));
                    });
                    
                    // Restore selected values from local storage
                    var savedExpiryDate = localStorage.getItem("selectedExpiryDate_op");
                    if (savedExpiryDate) {
                        expiryDateDropdown.val(savedExpiryDate);
                    }
                    
                    var savedSymbol = localStorage.getItem("selectedSymbol_op");
                    if (savedSymbol) {
                        symbolDropdown.val(savedSymbol);
                    }
                },
                error: function() {
                    console.log("Error occurred while fetching data.");
                }
            });
        }
        
        // Event listener for dropdown change
        $("#expiry-date").on("change", function() {
            var selectedExpiryDate_op = $(this).val();
            localStorage.setItem("selectedExpiryDate_op", selectedExpiryDate_op);
            fetchData();
        });
        
        $("#symbol").on("change", function() {
            var selectedSymbol_op = $(this).val();
            localStorage.setItem("selectedSymbol_op", selectedSymbol_op);
            fetchData();
        });
        
        // Initial data fetch
        fetchData();
    </script>
</body>
</html>
