<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.1/font/bootstrap-icons.css" rel="stylesheet">

</head>
<style>
    #stock-list-container {
        display: flex;
        flex-wrap: wrap;

        align-items: center;
    }

    .search_stock_sort {
        display: flex;
        gap: 5rem;
        align-items: flex-end;
    }

    .danger_change {
        border: 1px solid;
        border-radius: 5px;
        background: #ffeaea;
        padding: 0 7px;

    }

    .success_change {
        border: 1px solid;
        border-radius: 5px;
        background: #bde6bde4;
        padding: 0 7px;

    }

    .warning_change {
        border: 1px solid;
        border-radius: 5px;
        background: #fffccde4;
        padding: 0 7px;

    }

    .filter_all {
        background: rgba(33, 150, 243, .1);
        padding: 4px 12px 3px;
        -webkit-transition: all .2s ease-in-out;
        -moz-transition: all .2s ease-in-out;
        transition: all .2s ease-in-out;
        margin-top: 5px;
        font-weight: 500;
        color: dodgerblue;
        border-radius: 8px;
        cursor: pointer;
    }

    .filter_all:hover {
        background: linear-gradient(180deg, #4399eb, #5cadfb);
        color: #fff;
    }

    .success_hover {
        background: #dff5dfe4;
        padding: 4px 12px 3px;
        -webkit-transition: all .2s ease-in-out;
        -moz-transition: all .2s ease-in-out;
        transition: all .2s ease-in-out;
        margin-top: 5px;
        font-weight: 500;
        color: green;
        border-radius: 8px;
        cursor: pointer;
    }

    .success_hover:hover {
        background: #05ac72;
        color: #fff;

    }

    .warning_hover:hover {
        background: #f5b945;
        color: #fff;

    }

    .warning_hover {
        background: rgba(245, 185, 69, .1);
        color: #f5b945;

        padding: 4px 12px 3px;
        -webkit-transition: all .2s ease-in-out;
        -moz-transition: all .2s ease-in-out;
        transition: all .2s ease-in-out;
        margin-top: 5px;
        font-weight: 500;
        cursor: pointer;
        border-radius: 8px;

    }

    .danger_hover {
        background: rgba(235, 84, 99, .1);
        color: #eb5463;

        padding: 4px 12px 3px;
        -webkit-transition: all .2s ease-in-out;
        -moz-transition: all .2s ease-in-out;
        transition: all .2s ease-in-out;
        margin-top: 5px;
        font-weight: 500;
        cursor: pointer;
        border-radius: 8px;

    }

    .danger_hover:hover {
        background: #eb5463;
        color: #fff;
    }
    .active_stock_head{
        background: linear-gradient(180deg,#4399eb,#5cadfb)!important;
    color: #fff!important;
    }
</style>

<body>
    <div class="main_container p-3">
        <div class="main_analysis d-flex align-items-end"
            style="    white-space: nowrap;     justify-content: space-between;">


            <div class="btn-group d-flex" role="group" style="gap: 0.5rem; flex-wrap: wrap;">
                <div class="filter_all filter-btn" data-filter="all">All</div>

                <div class=" filter-btn success_hover" data-filter="gt5">5% <i class="bi bi-arrow-up"></i></div>
                <div class=" filter-btn success_hover" data-filter="between3to5">3 ~ 5%</div>


                <div class=" filter-btn success_hover" data-filter="between1to3">1 ~ 3%</div>


                <div class="warning_hover filter-btn" data-filter="between1toMinus1">1 ~
                    -1%</div>


                <div class="danger_hover filter-btn" data-filter="betweenMinus1toMinus3">-1 ~
                    -3%</div>

                <div class="danger_hover filter-btn" data-filter="betweenMinus3toMinus5">-3 ~
                    -5%</div>

                <div class="danger_hover filter-btn" data-filter="ltMinus5">-5% <i class="bi bi-arrow-down"></i></div>
            </div>

            <div class="search_stock_sort">
                <input type="text" id="search-input" class="form-control mt-3 w-50" placeholder="Search Stock">
                <div class="dropdown">
                    <button class="btn btn-light dropdown-toggle" type="button" id="sortDropdown"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Sort By
                    </button>
                    <div class="dropdown-menu" aria-labelledby="sortDropdown">
                        <a class="dropdown-item sort-btn" href="#" data-sort="az">A to Z</a>
                        <a class="dropdown-item sort-btn" href="#" data-sort="za">Z to A</a>
                        <a class="dropdown-item sort-btn" href="#" data-sort="gainers">Top Gainers</a>
                        <a class="dropdown-item sort-btn" href="#" data-sort="losers">Top Losers</a>
                    </div>
                </div>
            </div>
        </div>


        <div id="stock-list-container" class="mt-2"></div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
    var originalData = [];
    var currentFilter = "all"; // Variable to store the current filter

    $.ajax({
        url: "/stock_list",
        dataType: "json",
        success: function (data) {
            originalData = data.slice(); // Create a copy of the original data

            var stockListContainer = $("#stock-list-container");

            function renderStocks(stocks) {
                stockListContainer.empty();

                for (var i = 0; i < stocks.length; i++) {
                    var stock = stocks[i];

                    var stockItem = $("<div>", {
                        class: "col-lg-3 col-sm-6 p-2"
                    });

                    var stockLink = $("<a>", {
                        class: "text-decoration-none text-secondary",
                        target: "_blank",
                        href: "/stocks-analysis/" + stock.symbol_name
                    });

                    var stockListItem = $("<div>", {
                        class: "p-2 cursor-pointer stock-list-item bg-white d-flex align-items-center justify-content-between shadow fs-6",
                        title: stock.symbol_name
                    });

                    var stockName = $("<div>").append($("<h6>", {
                        class: "text-uppercase m-0 fw-500 fs-6 label-color-5",
                        text: stock.symbol_name
                    }));

                    var stockValues = $("<div>", {
                        class: "d-flex align-items-center"
                    });

                    var todayClose = $("<span>", {
                        class: "me-1 text-red fs-6",
                        text: stock.today_close
                    });

                    var changePercent = $("<span>", {
                        class: "stock_values fs-6 low_values",
                        text: stock.change_percent
                    });

                    if (parseFloat(stock.change_percent) < -1) {
                        changePercent.addClass("text-danger danger_change");
                        todayClose.addClass("text-danger");
                    } else if (parseFloat(stock.change_percent) > 1) {
                        changePercent.addClass("text-success success_change");
                        todayClose.addClass("text-success");
                    } else if (parseFloat(stock.change_percent) >= -1 && parseFloat(stock.change_percent) < 1) {
                        changePercent.addClass("text-warning warning_change");
                        todayClose.addClass("text-warning");
                    }
                    stockValues.append(todayClose, changePercent);

                    stockListItem.append(stockName, stockValues);
                    stockLink.append(stockListItem);
                    stockItem.append(stockLink);
                    stockListContainer.append(stockItem);
                }
            }

            // Initial display
            renderStocks(data);

            // Filter button click event
            $(".filter-btn").click(function () {
                $(".filter-btn").removeClass("active_stock_head"); // Remove "active_stock_head" class from all filter buttons
                $(this).addClass("active_stock_head"); // Add "active_stock_head" class to the clicked filter button

                currentFilter = $(this).data("filter"); // Update the current filter
                if (currentFilter === "all") {
                    renderStocks(originalData);
                } else {
                    var filteredStocks = originalData.filter(function (stock) {
                        var changePercent = parseFloat(stock.change_percent);
                        switch (currentFilter) {
                            case "gt5":
                                return changePercent > 5;
                            case "between3to5":
                                return changePercent >= 3 && changePercent <= 5;
                            case "between1to3":
                                return changePercent >= 1 && changePercent <= 3;
                            case "between1toMinus1":
                                return changePercent >= -1 && changePercent <= 1;
                            case "betweenMinus1toMinus3":
                                return changePercent >= -3 && changePercent <= -1;
                            case "betweenMinus3toMinus5":
                                return changePercent >= -5 && changePercent <= -3;
                            case "ltMinus5":
                                return changePercent < -5;
                            default:
                                return false;
                        }
                    });
                    renderStocks(filteredStocks);
                }
                // Save filter value to local storage
                localStorage.setItem("filter", currentFilter);
            });

            $("#search-input").on("keyup", function () {
                var searchTerm = $(this).val().trim().toLowerCase();
                var filteredStocks = originalData.filter(function (stock) {
                    return stock.symbol_name.toLowerCase().includes(searchTerm);
                });

                renderStocks(filteredStocks);
            });

            // Sort button click event
            $(".sort-btn").click(function () {
                $(".sort-btn").removeClass("active"); // Remove "active" class from all sort buttons
                $(this).addClass("active"); // Add "active" class to the clicked sort button

                var sortOption = $(this).data("sort");
                var sortedStocks = originalData.slice(); // Create a copy of the original data for sorting

                switch (sortOption) {
                    case "az":
                        sortedStocks.sort(function (a, b) {
                            return a.symbol_name.localeCompare(b.symbol_name);
                        });
                        break;
                    case "za":
                        sortedStocks.sort(function (a, b) {
                            return b.symbol_name.localeCompare(a.symbol_name);
                        });
                        break;
                    case "gainers":
                        sortedStocks.sort(function (a, b) {
                            return parseFloat(b.change_percent) - parseFloat(a.change_percent);
                        });
                        break;
                    case "losers":
                        sortedStocks.sort(function (a, b) {
                            return parseFloat(a.change_percent) - parseFloat(b.change_percent);
                        });
                        break;
                    default:
                        break;
                }

                if (currentFilter !== "all") {
                    // Apply the current filter to the sorted stocks
                    sortedStocks = sortedStocks.filter(function (stock) {
                        var changePercent = parseFloat(stock.change_percent);
                        switch (currentFilter) {
                            case "gt5":
                                return changePercent > 5;
                            case "between3to5":
                                return changePercent >= 3 && changePercent <= 5;
                            case "between1to3":
                                return changePercent >= 1 && changePercent <= 3;
                            case "between1toMinus1":
                                return changePercent >= -1 && changePercent <= 1;
                            case "betweenMinus1toMinus3":
                                return changePercent >= -3 && changePercent <= -1;
                            case "betweenMinus3toMinus5":
                                return changePercent >= -5 && changePercent <= -3;
                            case "ltMinus5":
                                return changePercent < -5;
                            default:
                                return false;
                        }
                    });
                }

                renderStocks(sortedStocks);
                // Save sort option to local storage
                localStorage.setItem("sortOption", sortOption);
            });

            // Retrieve and apply saved filter and sort option from local storage
            var savedFilter = localStorage.getItem("filter");
            var savedSortOption = localStorage.getItem("sortOption");
            if (savedFilter) {
                currentFilter = savedFilter; // Update the current filter
                $(".filter-btn[data-filter='" + savedFilter + "']").addClass("active");
                $(".filter-btn[data-filter='" + savedFilter + "']").click();
            }
            if (savedSortOption) {
                $(".sort-btn[data-sort='" + savedSortOption + "']").addClass("active");
                $(".sort-btn[data-sort='" + savedSortOption + "']").click();
            }
        }
    });
});

</script>

</body>

</html>