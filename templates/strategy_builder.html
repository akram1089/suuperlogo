{% extends "base_dashboard.html" %}
{% load static %}
{% block dashboard_body %}

<style>
  .strategies_active {
    color: white;
    background-color: #042452;
    border-color: #021a3d;
  }
</style>

<div class="container">
  <div class="main_head_strategies border-bottom my-4">
    <div class="strategies d-flex mt-4" style="align-items: center; gap: 0.3rem">
      <h4 class="">Strategy Builder</h4>
      <span>
        <i class="bi bi-exclamation-circle "  data-bs-toggle="collapse"
          data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"></i>
      </span>
    </div>
  </div>
  <div class="collapse" id="collapseExample" style="margin-bottom: 25px">
    <div class="card card-body">
      <div class="antd-pro-components-markdown-index-markdownStyle">
        <p>Strategies</p>
        <ul>
          <li>Bear Call, Put, Spread</li>
          <li>Bull Call, Put, Spread</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="option_chain_symbol">
    <div class="left_symbol">
      <select class="form-select" aria-label="Default select example">
        <option selected>Open this select menu</option>
        <option value="1">One</option>
        <option value="2">Two</option>
        <option value="3">Three</option>
      </select>
      <div class="option_chain_name">
        <p class="text-secondary" style="margin-bottom: auto !important; font-weight: 600;">Option Chain</p>
        <i class="bi bi-box-arrow-up-right"></i>
      </div>

      <div class="max_pain">
        <div class="max_pain_inner">
          <p class="text-secondary" style="margin-bottom: auto !important; font-weight: 600;">Max Pain</p>
          <i class="bi bi-box-arrow-up-right"></i>
        </div>
        <p class="text-secondary" style="margin-bottom: auto !important;">18700</p>
      </div>
      <div class="lot_size">
        <p class="text-secondary" style="margin-bottom: auto !important; font-weight: 600;">Lot Size</p>
        <p class="text-secondary" style="margin-bottom: auto !important;">50</p>
      </div>
      <div class="spot_price">
        <p class="text-secondary" style="margin-bottom: auto !important; font-weight: 600;">Spot</p>
        <p class="text-danger" style="margin-bottom: auto !important;">18729.4-26.5(-0.14%)</p>
      </div>
    </div>

    <div class="right_symbol d-flex">
      <button class="button btn btn-outline-primary">Option Chain</button>
      <button class="button btn btn-outline-primary">Futures</button>
      <button class="button btn btn-outline-primary">Saved Strategies</button>
      <i class="bi bi-arrow-clockwise text-primary"></i>
    </div>
  </div>

  <div class="pre_build_strategies">
    <div class="title">
      <h5>Pre Built Strategies :</h5>
    </div>
    <button class="button btn btn-outline-primary" onclick="filter_strategy(1)" data-btn-id="1">STRADDLE</button>
    <button class="button btn btn-outline-primary" onclick="filter_strategy(2)" data-btn-id="2">STRANGLE</button>
    <button class="button btn btn-outline-primary" onclick="filter_strategy(3)" data-btn-id="3">SPREAD</button>
    <button class="button btn btn-outline-primary" onclick="filter_strategy(4)" data-btn-id="4">IRON FLY</button>
    <button class="button btn btn-outline-primary" onclick="filter_strategy(5)" data-btn-id="5">IRON CONDOR</button>
    <button class="button btn btn-outline-primary" onclick="filter_strategy(6)" data-btn-id="6">JADE LIZARD</button>
  </div>

  <div class="pre_build_fields" id="pre_build_fields" style="    display: flex;
  flex-direction: column;
">
  
    <div id="dynamic-rows" style="    margin-top: 7px;
    margin-bottom: 7px;">
    
      <!-- Dynamic rows will be added here -->
    </div>
  </div>
</div>

<script>
  var strategy = [
    {
      id: 1,
      main_desc: `
      <div class="container">
        <div class="row">
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Instruments</option>
                <option >Call</option>
                <option>Put</option>
                <option>Future</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Expiry</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Strike Price</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Position</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="No. of Lots">
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="Traded Price">
            </div>
          </div>
          <div class="col">
            <button class="btn btn-primary add-row">
              <i class="bi bi-plus"></i>
            </button>
          </div>
        </div>
        <div id="dynamic-rows">
          <!-- Dynamic rows will be added here -->
        </div>
      </div>

      <div class="save_calc-btn" style="    width: 100%;
    display: flex;
    justify-content: flex-end;
    right: 10%;
    position: relative; gap:1rem;">
        <button class="button btn btn-outline-primary">SAVE</button><button class="button btn btn-outline-primary">CALCULATE</button>
      </div>
      `
    },
    {
      id: 2,
      main_desc: ` <div class="container">
        <div class="row">
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Instruments</option>
                <option >Call</option>
                <option>Put</option>
                <option>Future</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Expiry</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Strike Price</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Position</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="no. of lots">
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="traded price">
            </div>
          </div>
          <div class="col">
            <button class="btn btn-primary add-row">
              <i class="bi bi-plus"></i>
            </button>
          </div>
        </div>
        <div id="dynamic-rows">
          <!-- Dynamic rows will be added here -->
        </div>
      </div>
      <div class="save_calc-btn" style="    width: 100%;
    display: flex;
    justify-content: flex-end;
    right: 10%;
    position: relative; gap:1rem;">
        <button class="button btn btn-outline-primary">SAVE</button><button class="button btn btn-outline-primary">CALCULATE</button>
      </div>
      `
    },
    {
      id: 3,
      main_desc: ` <div class="container">
        <div class="row">
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Instruments</option>
                <option >Call</option>
                <option>Put</option>
                <option>Future</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Expiry</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Strike Price</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Position</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="no. of lots">
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="traded price">
            </div>
          </div>
          <div class="col">
            <button class="btn btn-primary add-row">
              <i class="bi bi-plus"></i>
            </button>
          </div>
        </div>
        <div id="dynamic-rows">
          <!-- Dynamic rows will be added here -->
        </div>
      </div>
      <div class="save_calc-btn" style="    width: 100%;
    display: flex;
    justify-content: flex-end;
    right: 10%;
    position: relative; gap:1rem;">
        <button class="button btn btn-outline-primary">SAVE</button><button class="button btn btn-outline-primary">CALCULATE</button>
      </div>
      `
    },
    {
      id: 4,
      main_desc: ` <div class="container">
        <div class="row">
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Instruments</option>
                <option >Call</option>
                <option>Put</option>
                <option>Future</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Expiry</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Strike Price</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Position</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="no. of lots">
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="traded price">
            </div>
          </div>
          <div class="col">
            <button class="btn btn-primary add-row">
              <i class="bi bi-plus"></i>
            </button>
          </div>
        </div>
        <div id="dynamic-rows">
          <!-- Dynamic rows will be added here -->
        </div>
      </div>
      <div class="save_calc-btn" style="    width: 100%;
    display: flex;
    justify-content: flex-end;
    right: 10%;
    position: relative; gap:1rem;">
        <button class="button btn btn-outline-primary">SAVE</button><button class="button btn btn-outline-primary">CALCULATE</button>
      </div>
      `
    },
    {
      id: 5,
      main_desc: ` <div class="container">
        <div class="row">
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Instruments</option>
                <option >Call</option>
                <option>Put</option>
                <option>Future</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Expiry</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Strike Price</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Position</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="no. of lots">
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="traded price">
            </div>
          </div>
          <div class="col">
            <button class="btn btn-primary add-row">
              <i class="bi bi-plus"></i>
            </button>
          </div>
        </div>
        <div id="dynamic-rows">
          <!-- Dynamic rows will be added here -->
        </div>
      </div>
      <div class="save_calc-btn" style="    width: 100%;
    display: flex;
    justify-content: flex-end;
    right: 10%;
    position: relative; gap:1rem;">
        <button class="button btn btn-outline-primary">SAVE</button><button class="button btn btn-outline-primary">CALCULATE</button>
      </div>
      `
    },
    {
      id: 6,
      main_desc: ` <div class="container">
        <div class="row">
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Instruments</option>
                <option >Call</option>
                <option>Put</option>
                <option>Future</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Expiry</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Strike Price</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <select class="form-select">
                <option selected>Position</option>
                <option>Select Option 1</option>
                <option>Select Option 2</option>
                <option>Select Option 3</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="no. of lots">
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <input type="number" class="form-control" placeholder="traded price">
            </div>
          </div>
          <div class="col">
            <button class="btn btn-primary add-row">
              <i class="bi bi-plus"></i>
            </button>
          </div>
        </div>
        <div id="dynamic-rows">
          <!-- Dynamic rows will be added here -->
        </div>
      </div>
      
      <div class="save_calc-btn" style="    width: 100%;
    display: flex;
    justify-content: flex-end;
    right: 10%;
    position: relative; gap:1rem;">
        <button class="button btn btn-outline-primary">SAVE</button><button class="button btn btn-outline-primary">CALCULATE</button>
      </div>
      `
    },
  ]

  document.getElementById("pre_build_fields").innerHTML = strategy[0].main_desc;

  function filter_strategy(id) {
    const Filtered_about = strategy.filter((Curr_dest) => {
      return Curr_dest.id === id;
    });

    Filtered_about.map((x) => {
      document.getElementById("pre_build_fields").innerHTML = x.main_desc;
    });

    initializeDynamicRows();
  }

  $(document).ready(function () {
    $('[data-btn-id]:first-child').addClass('strategies_active');
    $('[data-btn-id="1"]').addClass('strategies_active');

    // Filter button click event
    $('[data-btn-id]').click(function () {
      var btnId = $(this).attr('data-btn-id');
      filterResults(btnId);
      changeButtonColor($(this));
    });

    filterResults(1);
    initializeDynamicRows();

    function filterResults(btnId) {}

    function changeButtonColor(button) {
      $('[data-btn-id]').removeClass('strategies_active');
      button.addClass('strategies_active');
    }
  });

  function initializeDynamicRows() {
    var addRowButton = document.querySelector('.add-row');

    if (addRowButton) {
      addRowButton.removeEventListener('click', addDynamicRow);
    }

    var dynamicRowsContainer = document.getElementById('dynamic-rows');
    if (dynamicRowsContainer) {
      dynamicRowsContainer.removeEventListener('click', deleteDynamicRow);
    }

    var addButton = document.querySelector('.add-row');
    if (addButton) {
      addButton.addEventListener('click', addDynamicRow);
    }

    if (dynamicRowsContainer) {
      dynamicRowsContainer.addEventListener('click', deleteDynamicRow);
    }
  }

  function addDynamicRow() {
    var dynamicRows = document.getElementById('dynamic-rows');

    var newRow = document.createElement('div');
    newRow.classList.add('row', 'dynamic-row');
    newRow.innerHTML = `
      <div class="col">
        <div class="form-group">
          <select class="form-control">
            <option>Select Option 1</option>
            <option>Select Option 2</option>
            <option>Select Option 3</option>
          </select>
        </div>
      </div>
      <div class="col">
        <div class="form-group">
          <select class="form-control">
            <option>Select Option 1</option>
            <option>Select Option 2</option>
            <option>Select Option 3</option>
          </select>
        </div>
      </div>
      <div class="col">
        <div class="form-group">
          <select class="form-control">
            <option>Select Option 1</option>
            <option>Select Option 2</option>
            <option>Select Option 3</option>
          </select>
        </div>
      </div>
      <div class="col">
        <div class="form-group">
          <select class="form-control">
            <option>Select Option 1</option>
            <option>Select Option 2</option>
            <option>Select Option 3</option>
          </select>
        </div>
      </div>
      <div class="col">
        <div class="form-group">
          <input type="number" class="form-control">
        </div>
      </div>
      <div class="col">
        <div class="form-group">
          <input type="number" class="form-control">
        </div>
      </div>
      <div class="col">
        <button class="btn btn-danger delete-row">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    `;

    dynamicRows.appendChild(newRow);
  }

  function deleteDynamicRow(event) {
    if (event.target.classList.contains('delete-row')) {
      var row = event.target.closest('.dynamic-row');
      row.remove();
    }
  }
</script>
{% endblock %}
